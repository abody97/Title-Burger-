<!-- index.html --><!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø¹Ø§Ù… - ØªØ§ÙŠØªÙ„ Ø¨Ø±Ø¬Ø±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="manifest" href="manifest.json">
  <style>
    body { padding: 20px; background-color: #fff; font-family: 'Tajawal', sans-serif; }
    h2 { text-align: center; margin-bottom: 20px; }
    table input { width: 100%; border: none; background: transparent; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“¦ Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…Ø·Ø¹Ù…</h2><div class="mb-3">
  <input type="text" class="form-control" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù..." onkeyup="searchTable()">
</div>

<div class="d-flex flex-wrap gap-2 justify-content-between mb-3">
  <button class="btn btn-success" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
  <a class="btn btn-dark" href="daily.html">ğŸ“… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</a>
  <a class="btn btn-primary" href="stats.html">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a>
  <button class="btn btn-warning" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸</button>
  <button class="btn btn-info" onclick="loadData()">ğŸ“‚ ØªØ­Ù…ÙŠÙ„</button>
  <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
  <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
  <button class="btn btn-outline-primary" onclick="exportToExcel()">ğŸ“¤ ØªØµØ¯ÙŠØ± Excel</button>
</div>

<table class="table table-bordered text-center align-middle" id="inventory-table">
  <thead class="table-light">
    <tr>
      <th>#</th>
      <th>Ø§Ù„ØµÙ†Ù</th>
      <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
      <th>Ø§Ù„Ù…ØªÙˆÙØ±</th>
      <th>Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
      <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
      <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ø±Ø¯</th>
      <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
      <th>ğŸ› ï¸</th>
    </tr>
  </thead>
  <tbody id="inventory-body"></tbody>
</table>

  </div>  <script>
    let counter = 1;

    function addRow(item = {}) {
      const tbody = document.getElementById('inventory-body');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${counter}</td>
        <td><input type="text" value="${item.name || ''}" oninput="autoSave()"></td>
        <td><input type="text" value="${item.unit || ''}" oninput="autoSave()"></td>
        <td><input type="number" oninput="calcRemaining(this)" value="${item.available || ''}"></td>
        <td><input type="number" oninput="calcRemaining(this)" value="${item.used || ''}"></td>
        <td><input type="number" readonly></td>
        <td><input type="date" value="${item.date || new Date().toISOString().split('T')[0]}" oninput="autoSave()"></td>
        <td><input type="text" value="${item.notes || ''}" oninput="autoSave()"></td>
        <td><button class="btn btn-sm btn-danger" onclick="removeRow(this)">ğŸ—‘ï¸</button></td>
      `;
      tbody.appendChild(row);
      calcRemaining(row.querySelectorAll('input')[2]);
      counter++;
    }

    function calcRemaining(input) {
      const row = input.closest('tr');
      const available = parseFloat(row.children[3].querySelector('input').value) || 0;
      const used = parseFloat(row.children[4].querySelector('input').value) || 0;
      const remainingField = row.children[5].querySelector('input');
      const remaining = available - used;
      remainingField.value = remaining;
      remainingField.style.backgroundColor = (remaining <= 2) ? "#f8d7da" : "#d1e7dd";
      autoSave();
    }

    function removeRow(btn) {
      btn.closest('tr').remove();
      updateRowNumbers();
      autoSave();
    }

    function updateRowNumbers() {
      const rows = document.querySelectorAll('#inventory-body tr');
      counter = 1;
      rows.forEach((row) => row.children[0].textContent = counter++);
    }

    function saveData() {
      const rows = document.querySelectorAll('#inventory-body tr');
      const data = [];
      rows.forEach((row) => {
        const inputs = row.querySelectorAll('input');
        data.push({
          name: inputs[0].value,
          unit: inputs[1].value,
          available: inputs[2].value,
          used: inputs[3].value,
          remaining: inputs[4].value,
          date: inputs[5].value,
          notes: inputs[6].value,
        });
      });
      localStorage.setItem('inventoryData', JSON.stringify(data));
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem('inventoryData')) || [];
      document.getElementById('inventory-body').innerHTML = '';
      counter = 1;
      data.forEach(item => addRow(item));
    }

    function clearData() {
      if (confirm("ğŸ›‘ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø±Ø¯ØŸ")) {
        localStorage.removeItem('inventoryData');
        document.getElementById('inventory-body').innerHTML = '';
        counter = 1;
      }
    }

    function exportToExcel() {
      const table = document.getElementById('inventory-table');
      const wb = XLSX.utils.table_to_book(table, { sheet: "Ø¬Ø±Ø¯ Ø¹Ø§Ù…" });
      XLSX.writeFile(wb, "Ø¬Ø±Ø¯_Ø¹Ø§Ù….xlsx");
    }

    function searchTable() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const rows = document.querySelectorAll("#inventory-body tr");
      rows.forEach(row => {
        const name = row.children[1].querySelector('input').value.toLowerCase();
        row.style.display = name.includes(input) ? '' : 'none';
      });
    }

    function autoSave() {
      saveData();
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log("âœ… Service Worker Ù…Ø³Ø¬Ù‘Ù„"))
        .catch(err => console.log("âŒ Service Worker ÙØ´Ù„:", err));
    }

    window.onload = loadData;
  </script></body>
</html>